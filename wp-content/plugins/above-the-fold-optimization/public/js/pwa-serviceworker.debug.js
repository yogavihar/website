!function(p,q,A){function P(a,c,g){return caches.open(r).then(function(b){var e={};return c.headers.forEach(function(a,b){e[b]=a}),e["x-abtf-sw"]=n(),g&&g.max_age&&(e["x-abtf-sw-expire"]=g.max_age),c.blob().then(function(h){h=new Response(h,{status:c.status,statusText:c.statusText,headers:e});return b.put(a,h)})})}function K(a){if(a)return"string"==typeof a&&(a=new Request(a,{mode:"no-cors"})),w(a).then(function(c){return c||(console.info("Abtf.sw() \u27a4 preload",a.url),u(a,{conditions:null}))})}
function w(a){var c=l.start(1E3);return caches.open(r).then(function(g){return g.match(a).then(function(b){if(b){var e=b.headers.get("x-abtf-sw-expire");if(e)var h=b.headers.get("x-abtf-sw");var f=b.headers.get("expire");f&&(f=B(f));e&&h<n()-e?(b=!1,console.info("Abtf.sw() \u27a4 cache expired by policy",a.url,"max age:",e)):f&&f<n()&&(b=!1,console.info("Abtf.sw() \u27a4 cache expired by HTTP expire",a.url,b.headers.get("expire")))}return l.complete(c),b})})}function G(a,c){return a=new Request(a),
w(a).then(function(a){return a?a.blob().then(function(b){return new Response(b,{status:503,statusText:"Offline",headers:a.headers})}):q(c)["catch"](function(a){setTimeout(function(){throw a;})})})}function Q(a,c,g,b){var e=g.headers.get("etag"),h=B(g.headers.get("last-modified"));if(e||h){var f=l.start(1E3);g=new Request(a.url,{method:"HEAD",headers:a.headers,mode:"no-cors"});q(g).then(function(d){var k=!1,L=d.headers.get("etag");d=B(d.headers.get("last-modified"));return(L&&L!==e?k=!0:d&&d!==h&&
(k=!0),k)?(console.info("Abtf.sw() \u27a4 HEAD \u27a4 update",a.url),k=u(a,c),k=k.then(function(a){return l.complete(f),a}),b&&(k=k.then(b)),k):(l.complete(f),null)})["catch"](function(){var d=u(a,c);return d=d.then(function(a){return l.complete(f),a}),b&&(d=d.then(b)),d})}else console.warn("Abtf.sw() \u27a4 HEAD \u27a4 no etag or last-modified",a.url),g=u(a,c),b&&(g=g.then(b))}function u(a,c,g){var b=l.start(1E3);return R(a.headers.get("accept")).then(function(e){var h=a;return e&&(h=new Request(h)).headers.set("cache-digest",
e),q(h).then(function(a){var d=!1;if(a.ok&&400>a.status){var f=a.headers.get("link");f&&(f instanceof Array||(f=[f]),l.f(function(){caches.open(r+":push").then(function(a){f.forEach(function(d){d.split(",").forEach(function(d){if(/rel=preload/.test(d)){var b=d.match(/<([^>]+)>/);b&&b[1]&&a.match(b[1]).then(function(d){d||a.put(b[1],new Response(null,{status:204}))})}})})})},1E3));c&&(d=!0,c.conditions&&(c.conditions.forEach(function(b){if(d)switch(b.type){case "url":b.regex?(c=C(b.pattern))?(e=c.test(h.url),
b.not?e&&(d=!1):e||(d=!1)):d=!1:(e=-1!==h.url.indexOf(b.pattern),b.not?e&&(d=!1):e||(d=!1));break;case "header":var f=a.headers.get(b.name);if(f)if(b.regex){var c=C(b.pattern);c?(e=c.test(f),b.not?e&&(d=!1):e||(d=!1)):d=!1}else if("object"==typeof b.pattern)if(b.pattern.operator)if(f=parseFloat(f),c=parseFloat(b.pattern.value),isNaN(f)||isNaN(c))d=!1;else{switch(b.pattern.operator){case "<":e=f<c;break;case ">":e=f>c;break;case "=":var e=f===c;break;default:d=!1}d&&(b.not?e&&(d=!1):e||(d=!1))}else d=
!1;else-1===f.indexOf(b.pattern)&&(d=!1);else d=!1}}),d?console.info("Abtf.sw() \u27a4 cache condition \u27a4 cache",h.url,c.conditions):console.info("Abtf.sw() \u27a4 cache condition \u27a4 no cache",h.url,c.conditions)),d&&P(h,a.clone(),c).then(function(){l.complete(b)}))}return d||l.complete(b),a})["catch"](function(a){return l.complete(b),g?g(h,null,a):null})})}function M(){H||(!I||I<n()-10)&&(H=!0,I=n(),caches.keys().then(function(a){return a&&0!==a.length?Promise.all(a.map(function(a){if(0!==
a.indexOf(r))return console.info("Abtf.sw() \u27a4 old cache deleted",a),caches["delete"](a);caches.open(a).then(function(c){c.keys().then(function(b){if(console.info("Abtf.sw() \u27a4 prune cache",a,"size:",b.length,y),!(b.length<y)){var e=[],h=[],f=[];return b.forEach(function(a){h.push(a);f.push(c.match(a))}),Promise.all(f).then(function(a){var b=n();a.forEach(function(a,d){if(a&&a.headers){var f=a.headers.get("x-abtf-sw");if(f){var k=a.headers.get("x-abtf-sw-expire");if(k&&f&&f<n()-k)return console.info("Abtf.sw() \u27a4 cache \u27a4 expired",
a.url),void c["delete"](h[d])}else f=b;!1!==e&&e.push({t:f,r:h[d]})}});e&&e.length>y&&(e.sort(function(a,b){return a.t>b.t?-1:a.t<b.t?1:0}),e.slice(y).forEach(function(a){c["delete"](a.r)}))})}})})})).then(function(){H=!1}):Promise.resolve()}))}function C(a){if(a=a.match(S)){try{var c=new RegExp(a[1],a[2])}catch(g){}return c||!1}}function B(a){if(a)return isNaN(parseInt(a))?(a=Date.parse(a),isNaN(a)?void 0:Math.round(a/1E3)):a}function n(){return Math.round(Date.now()/1E3)}function D(){return v?Promise.resolve():
(N(),v=!0,q(E+"?"+Math.round(Date.now()/1E3),{mode:"no-cors"}).then(function(a){if(v=!1,a&&a.ok&&400>a.status)return a.json().then(function(a){if(console.info("Abtf.sw() \u27a4 config "+(m?"updated":"loaded"),a),a){a instanceof Array&&(a={policy:a});a.policy&&(m=a.policy,z=n());var c=[];a.start_url&&c.push(a.start_url);a.policy&&a.policy.forEach(function(a){a.offline&&-1===c.indexOf(a.offline)&&c.push(a.offline)});a.preload&&a.preload.forEach(function(a){-1===c.indexOf(a)&&c.push(a)});preloadPromises=
[];c.forEach(function(a){preloadPromises.push(K(a))})}});throw m=!1,Error("service worker config not found: "+E);})["catch"](function(a){m=v=!1;setTimeout(function(){throw a;})}))}function O(a){(new Promise(function(c){if(!m||!z||a&&a>z){var g=!m;D().then(function(){g&&c(m?m:!1)})["catch"](function(){g&&c(!1)})}else if(!v&&z<n()-300){N();v=!0;var b=new Request(E+"?"+Math.round(Date.now()/1E3),{method:"HEAD",mode:"no-cors"});q(b).then(function(a){v=!1;var b=!0;a&&a.ok&&(a=B(a.headers.get("last-modified")))&&
a<=z&&(b=!1);b&&D()})["catch"](function(){v=!1;D()})}else c(m)}))["catch"](function(a){setTimeout(function(){throw a;})})}function R(a){return a&&a.includes("text/html")?new Promise(function(a){caches.open(r+":push").then(function(c){c.keys().then(function(b){if(0===b.length)return a(null);var c=[];b.forEach(function(a){c.push(w(a))});Promise.all(c).then(function(c){var f=[];b.forEach(function(a,b){"undefined"!==c[b]&&c[b]&&f.push(a.url)});0===f.length?a(null):T(f,Math.pow(2,7)).then(function(b){a(b)})})})})}):
Promise.resolve(null)}function N(){var a=new URL(location);(J=a.searchParams.get("path"))||(J="/");(a=a.searchParams.get("config"))||(a="abtf-pwa-config.json");E=J+a}var J,E,r,m=!1,z=!1,y=1E3;p.addEventListener("install",function(a){a.waitUntil(D().then(function(){p.skipWaiting()})["catch"](function(){p.skipWaiting()}))});p.addEventListener("activate",function(a){a.waitUntil(p.clients.claim())});A.prototype.add||(A.prototype.add=function(a){return this.addAll([a])});A.prototype.addAll||(A.prototype.addAll=
function(a){function c(a){this.name="NetworkError";this.code=19;this.message=a}var g=this;return c.prototype=Object.create(Error.prototype),Promise.resolve().then(function(){if(1>arguments.length)throw new TypeError;return a=a.map(function(a){return a instanceof Request?a:String(a)}),Promise.all(a.map(function(a){"string"==typeof a&&(a=new Request(a));var b=(new URL(a.url)).protocol;if("http:"!==b&&"https:"!==b)throw new c("Invalid scheme");return q(a.clone())["catch"](function(a){setTimeout(function(){throw a;
})})}))}).then(function(b){return Promise.all(b.map(function(b,c){return g.put(a[c],b)}))}).then(function(){})});CacheStorage.prototype.match||(CacheStorage.prototype.match=function(a,c){var g=this;return this.keys().then(function(b){var e;return b.reduce(function(b,f){return b.then(function(){return e||g.open(f).then(function(b){return b.match(a,c)}).then(function(a){return e=a})})},Promise.resolve())})});var v,T=function(){function a(){this.value=[];this.a=0}function c(a,b){return a-b}function g(a,
d,c){return new Promise(function(f){var e=b(a);crypto.subtle.digest("SHA-256",h.encode(e)).then(function(a){a=(new DataView(a)).getUint32(0);var b=Math.log2(d*c);if(31<b)throw Error("This implementation only supports up to 31 bit hash values");f(a>>32-b&(1<<b)-1)})})}function b(a){return a.replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16)})}function b(a){return a.replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16)})}function e(b,d){if(d>=Math.pow(2,32))throw Error('Invalid probability: "${p}" must be smaller than 2**32');
if(!(0<d&&(d&1+~d)===d))throw Error('Invalid probability: "${p}" must be a power of 2');var f,e=Math.min(Math.pow(2,Math.round(Math.log2(b.length))),Math.pow(2,31)),h=[];return new Promise(function(k){Promise.all(b.map(function(a){return g(a,e,d)})).then(function(){h=h.concat().sort(c);f=Uint8Array.from((new a).c(Math.log2(e),5).c(Math.log2(d),5).g(h,Math.log2(d)).value);var b;b="";for(var g=f.byteLength,t=0;t<g;t++)b+=String.fromCharCode(f[t]);b=btoa(b).replace(/=+$/,"");k(b)})})}a.prototype.b=function(a){0==
this.a&&(this.value.push(0),this.a=8);--this.a;a&&(this.value[this.value.length-1]|=1<<this.a)};a.prototype.c=function(a,b){if(0!=b){do--b,this.b(a&1<<b);while(0!=b)}return this};a.prototype.g=function(a,b){for(var d=-1,c=0;c!=a.length;++c)if(d!=a[c]){for(var d=a[c]-d-1,f=d>>b;0!=f;--f)this.b(0);this.b(1);this.c(d,b);d=a[c]}return this};var h=new TextEncoder("utf-8");return function(a,b){return e(a,b)}}(),l=function(){function a(e,h,f){var d=!1,k=Object.keys(c);if(0<k.length){var g=Date.now();k.forEach(function(a){if(!d)if(c[a][0]<
g-c[a][1])try{delete c[a]}catch(V){}else d=!0})}if(d){if(0!==h){var t;if(f){var x=!1;b.forEach(function(a,b){x||a[2]==f&&(x=b)});x&&(b[x][1]&&clearTimeout(b[x][1]),t=x)}t||(t=b.push([])-1);b[t]=[e,setTimeout(function(d,c){delete b[d];c();0<b.length&&a(null,0)},h,t,e),f]}}else if(e&&b.push([e]),0<b.length)for(e=b.shift();e;){if(e instanceof Array){e[1]&&clearTimeout(e[1]);try{e[0]()}catch(U){}}e=b.shift()}}var c={},g=0,b=[];return{start:function(a){var b=++g;return c[b]=[Date.now(),a],b},complete:function(e){try{delete c[e]}catch(h){}0<
b.length&&a(null,0)},f:a}}(),S=/^\/(.*)\/([gimuy]+)?$/,I=!1,H=!1,F=!1;p.addEventListener("fetch",function(a){if("GET"===a.request.method){var c=!1;if(["wp-admin/","wp-login.php"].forEach(function(b){c||(b=new RegExp("^([^/]+)?//"+p.location.host+"(:[0-9]+)?/"+b),(b.test(a.request.url)||a.request.referrer&&b.test(a.request.referrer))&&(c=!0))}),!(c||a.request.url.match(/\&preview=true/)||a.request.url.match(/\&preview_nonce=/))&&(O(),m&&r)){var g=function(a,c){if(!c||0===c.length)return!1;var b=!1;
if(c.forEach(function(c){if(!b&&c.match&&0!==c.match.length){var d=!0;c.match.forEach(function(b){if(d)switch(b.type){case "url":if(b.regex)(e=C(b.pattern))?(g=e.test(a.request.url),b.not?g&&(d=!1):g||(d=!1)):d=!1;else if(b.pattern instanceof Array){var c=!1;b.pattern.forEach(function(b){c||-1!==a.request.url.indexOf(b)&&(c=!0)});b.not?c&&(d=!1):c||(d=!1)}else g=-1!==a.request.url.indexOf(b.pattern),b.not?g&&(d=!1):g||(d=!1);break;case "header":switch(b.name.toLowerCase()){case "referer":case "referrer":f=
a.request.referrer;break;default:var f=a.request.headers.get(b.name)}if(f)if(b.regex){var e=C(b.pattern);e?(g=e.test(f),b.not?g&&(d=!1):g||(d=!1)):d=!1}else{var g=-1!==f.indexOf(b.pattern);b.not?g&&(d=!1):g||(d=!1)}else b.not||(d=!1)}});d&&(b=c)}}),!b)return console.info("Abtf.sw() \u27a4 policy \u27a4 no match",a.request.url),!1;switch(console.info("Abtf.sw() \u27a4 policy \u27a4 match",a.request.url,b),F&&clearTimeout(F),F=setTimeout(function(){l.f(M,1E4,"clean-cache");F=!1},100),b.strategy){case "never":return!1;
case "cache":return w(a.request).then(function(c){if(c){var d=!0,f=b.cache.update_interval?!isNaN(parseInt(b.cache.update_interval))&&parseInt(b.cache.update_interval):!1;if(f){var e=c.headers.get("x-abtf-sw");e&&parseInt(e)>n()-f&&(d=!1)}return d&&function(a,c){setTimeout(function(){var d;if(b.cache.h&&(d=function(){clients.matchAll().then(function(b){b.forEach(function(b){b.postMessage([2,a.url])})})}),b.cache.head_update)console.info("Abtf.sw() \u27a4 HEAD \u27a4 verify",a.url),Q(a,b.cache,c,d);
else{console.info("Abtf.sw() \u27a4 update cache",a.url);var f=u(a,b.cache);d&&f.then(d)}},10)}(a.request.clone(),c.clone()),console.info("Abtf.sw() \u27a4 from cache",a.request.url),c}return u(a.request,b.cache,function(c,d,f){return b.offline?(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 offline page",c.url),G(b.offline,c.clone())):(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 empty 404 response",c.url,d,f),d||q(a.request.clone())["catch"](function(a){setTimeout(function(){throw a;
})}))})});case "event":return w(a.request).then(function(c){return c?(console.info("Abtf.sw() \u27a4 from cache",a.request.url),c):u(a.request,null,function(c,f){return b.offline?(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 offline page",c.url),G(b.offline,c.clone())):(console.warn("Abtf.sw() \u27a4 no cache \u27a4 network failed \u27a4 empty 404 response",c.url,f),f||q(a.request)["catch"](function(a){setTimeout(function(){throw a;})}))})});default:return u(a.request,b.cache,
function(c,d,e){return console.warn("Abtf.sw() \u27a4 network failed",c.url,d||e),w(c).then(function(e){return e?(console.info("Abtf.sw() \u27a4 fallback from cache",c.url),e):b.offline?(console.warn("Abtf.sw() \u27a4 no cache \u27a4 offline page",c.url),G(b.offline,c.clone())):(console.warn("Abtf.sw() \u27a4 no cache \u27a4 empty 404 response",c.url),d||q(a.request)["catch"](function(a){setTimeout(function(){throw a;})}))})})}}(a,m);if(!1!==g)return a.respondWith(g)}}});p.addEventListener("message",
function(a){if(a&&a.data&&a.data instanceof Array){if(1===a.data[0]){a.data[1]&&!isNaN(parseInt(a.data[1]))&&O(parseInt(a.data[1]));a.data[3]&&!isNaN(parseInt(a.data[3]))&&(y=parseInt(a.data[3]));var c="abtf:"+(a.data[2]?a.data[2]+":":"");c!==r&&(r=c,console.info("Abtf.sw() \u27a4 cache prefix changed",r));l.f(M,1E4,"clean-cache")}if(2===a.data[0]||3===a.data[0])var g=a.ports[0]?function(b,c){a.ports[0].postMessage({error:b,status:c})}:!1;if(2===a.data[0])if(a.data[1]){var b;if("string"==typeof a.data[1]||
a.data[1]instanceof Request?b=[a.data[1]]:a.data[1]instanceof Array&&(b=a.data[1]),b){var e=[];b.forEach(function(a){e.push(K(a))});g&&Promise.all(e).then(function(a){var b=[];a.forEach(function(a){var c={url:a.url,status:a.status,statusText:a.statusText};a=a.headers.get("content-length");c.size=isNaN(parseInt(a))?-1:parseInt(a);b.push(c)});g(null,b)})["catch"](function(a){console.error("Abtf.sw() \u27a4 preload",a)})}else g&&g("invalid-data")}else g&&g("no-urls");3===a.data[0]&&(p.registration.showNotification(a.data[1],
a.data[2]),g&&g(null,"sent"))}})}(self,self.fetch,Cache);
